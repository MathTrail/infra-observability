# Grafana k8s-monitoring (Alloy collectors)
# Backends (Loki, Grafana, Tempo, Mimir) are deployed as separate Helm releases.

cluster:
  name: "mathtrail-local"

# Destinations for telemetry â€” local embedded backends
destinations:
  - name: local-mimir
    type: prometheus
    url: http://mimir:9009/api/v1/push
  - name: local-loki
    type: loki
    url: http://loki:3100/loki/api/v1/push
  - name: local-tempo
    type: otlp
    url: http://tempo:4317

# Enable Grafana Alloy receiver for application observability
applicationObservability:
  enabled: true
  collector: alloy-receiver
  destinations:
    - local-mimir
    - local-loki
    - local-tempo
  receivers:
    # OTLP receiver - this is where OTel Collector sends data
    otlp:
      grpc:
        enabled: true
        port: 4317
      http:
        enabled: true
        port: 4318

# Enable pod logs collection
podLogs:
  enabled: true
  collector: alloy-logs
  destinations:
    - local-loki

# Enable cluster metrics
clusterMetrics:
  enabled: true
  collector: alloy-metrics
  destinations:
    - local-mimir

# Enable cluster events
clusterEvents:
  enabled: true
  collector: alloy-singleton
  destinations:
    - local-loki

# Alloy receiver configuration
alloy-receiver:
  enabled: true
  replicas: 2
  resources:
    requests:
      cpu: "200m"
      memory: "256Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

# Alloy singleton configuration (required for cluster events)
alloy-singleton:
  enabled: true
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

# Alloy logs configuration
alloy-logs:
  enabled: true
  mode: daemonset
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

# Alloy metrics configuration
alloy-metrics:
  enabled: true
  mode: daemonset
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
